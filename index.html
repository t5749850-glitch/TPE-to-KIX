<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…éŠè¡Œç¨‹èˆ‡äº’å‹•çœ‹æ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #4f46e5;
            --bg-light: #f9fafb;
        }
        body {
            background-color: var(--bg-light);
            font-family: system-ui, -apple-system, sans-serif;
        }
        /* é ‚éƒ¨æ©«å‘èƒŒæ™¯åœ–æ¨£å¼ */
        .hero-section {
            height: 250px;
            background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://t5749850-glitch.github.io/TPE-to-KIX/images/HOME.jpg');
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }
        .day-card {
            background: white;
            border-radius: 12px;
            margin-bottom: 1rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .day-header {
            padding: 1.25rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
        }
        .day-header:hover { background: #f8fafc; }
        .day-content { display: none; border-top: 1px solid #f1f5f9; }
        .day-card.open .day-content { display: block; }
        .day-card.open .toggle-icon { transform: rotate(90deg); }
        .toggle-icon { transition: transform 0.2s; color: #94a3b8; }
        
        .timeline-event {
            position: relative;
            padding-left: 2rem;
            margin-bottom: 1.5rem;
            border-left: 2px solid #e2e8f0;
        }
        .timeline-event::before {
            content: '';
            position: absolute;
            left: -7px;
            top: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            border: 2px solid white;
        }
        .event-time { font-weight: 600; color: var(--primary); font-size: 0.875rem; }
        
        /* Highlight æ¨£å¼ï¼šé‡å°æ²’æœ‰é¡å¤–æç¤ºçš„äº‹ä»¶é€²è¡Œè¦–è¦ºå¼·åŒ– */
        .event-highlight {
            color: #111827; /* æ›´æ·±ã€æ›´é†’ç›®çš„æ–‡å­—é¡è‰² */
            font-size: 1.05rem;
        }

        .filter-button {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            background: #e2e8f0;
            color: #475569;
            transition: all 0.2s;
            white-space: nowrap;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .filter-button.active {
            background: var(--primary);
            color: white;
        }
        
        .todo-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
        }
        .todo-text.done { text-decoration: line-through; color: #94a3b8; }

        .image-placeholder {
            width: 100%;
            height: 150px;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            margin-bottom: 1rem;
            background-color: #eee;
        }
        /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒåŠŸèƒ½ */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>

    <!-- é ‚éƒ¨æ©«å‘èƒŒæ™¯åœ–å€åŸŸ -->
    <div class="hero-section mb-6">
        <div>
            <h1 class="text-4xl md:text-5xl font-bold mb-2">é—œè¥¿6æ—¥éŠ</h1>
            <p class="text-lg opacity-90">é—œè¥¿äº¬åŒ—ç§˜å¢ƒèˆ‡åŸå¸‚æ¢ç´¢ â€” 2025/12/20 è‡³ 12/25</p>
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-4 pb-8">
        <header class="mb-8">
            <!-- å°è¦½åˆ‡æ›æŒ‰éˆ• -->
            <div class="flex gap-2 overflow-x-auto pb-4 scrollbar-hide border-b border-gray-100" id="filter-bar">
                <button class="filter-button" data-filter="checklist">ğŸ“ æº–å‚™æ¸…å–®</button>
                <button class="filter-button active" data-filter="all">å…¨éƒ¨è¡Œç¨‹</button>
            </div>
        </header>

        <!-- è¡Œç¨‹åˆ—è¡¨å…§å®¹å€ -->
        <div id="itinerary-timeline" class="space-y-4">
            <div class="text-center p-10 text-gray-500">æ­£åœ¨åˆå§‹åŒ–ç³»çµ±ä¸¦è¼‰å…¥è¡Œç¨‹...</div>
        </div>

        <!-- æº–å‚™æ¸…å–®å…§å®¹å€ -->
        <div id="checklist-view" class="hidden bg-white rounded-xl shadow p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">æº–å‚™æ¸…å–®</h2>
                <span id="sync-status" class="text-sm text-gray-400">æ­£åœ¨åŒæ­¥...</span>
            </div>
            <div id="checklist-content" class="space-y-2"></div>
        </div>
    </div>

    <script>
        // --- è¨­å®š ---
        const ITINERARY_GIST_URL = 'https://gist.githubusercontent.com/t5749850-glitch/1b2cb36a31022afe02196d5def094198/raw/98b2bff7c74f50e8095b1e34aab085caf0790583/itinerary.json'; 
        const GIST_ID = 'a88a62f92e6fb58e173bb5f04388deea'; 
        const FILE_NAME = 'Travel_List.md'; 
        const GIST_URL = `https://gist.githubusercontent.com/raw/${GIST_ID}/${FILE_NAME}`;

        // --- ç‹€æ…‹ ---
        let itineraryData = [];

        // --- åˆå§‹åŒ– ---
        async function initApp() {
            const timeline = document.getElementById('itinerary-timeline');
            
            try {
                const res = await fetch(ITINERARY_GIST_URL + '?t=' + new Date().getTime());
                if (!res.ok) throw new Error('ç„¡æ³•å–å¾—è¡Œç¨‹è³‡æ–™');
                
                itineraryData = await res.json();
                generateDayButtons();
                renderItinerary('all');
            } catch (e) {
                console.error(e);
                timeline.innerHTML = `<div class="p-6 bg-red-50 text-red-600 rounded-lg">âš ï¸ è¡Œç¨‹è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªç¶²è·¯é€£ç·šã€‚</div>`;
            }
        }

        // --- å‹•æ…‹ç”Ÿæˆæ—¥æœŸæŒ‰éˆ• ---
        function generateDayButtons() {
            const filterBar = document.getElementById('filter-bar');
            
            // å°‡ Day æŒ‰éˆ•æ’å…¥åœ¨æœ€å¾Œé¢
            itineraryData.forEach(day => {
                const btn = document.createElement('button');
                btn.className = 'filter-button';
                btn.dataset.filter = day.day;
                btn.textContent = `Day ${day.day}`;
                btn.onclick = () => handleFilterClick(btn);
                filterBar.appendChild(btn);
            });

            filterBar.querySelector('[data-filter="all"]').onclick = function() { handleFilterClick(this); };
            filterBar.querySelector('[data-filter="checklist"]').onclick = function() { handleFilterClick(this); };
        }

        // --- è™•ç†æŒ‰éˆ•é»æ“Š ---
        function handleFilterClick(clickedBtn) {
            document.querySelectorAll('.filter-button').forEach(b => b.classList.remove('active'));
            clickedBtn.classList.add('active');
            renderItinerary(clickedBtn.dataset.filter);
            window.scrollTo({ top: 220, behavior: 'smooth' });
        }

        // --- è¡Œç¨‹æ¸²æŸ“é‚è¼¯ ---
        function renderItinerary(filter) {
            const timeline = document.getElementById('itinerary-timeline');
            const checklistView = document.getElementById('checklist-view');
            
            if (filter === 'checklist') {
                timeline.classList.add('hidden');
                checklistView.classList.remove('hidden');
                loadChecklist();
                return;
            }

            timeline.classList.remove('hidden');
            checklistView.classList.add('hidden');
            timeline.innerHTML = '';

            itineraryData.forEach(day => {
                if (filter === 'all' || String(day.day) === String(filter)) {
                    const card = document.createElement('div');
                    card.className = 'day-card open';
                    card.id = `day-card-${day.day}`;
                    card.innerHTML = `
                        <div class="day-header" onclick="this.parentElement.classList.toggle('open')">
                            <div>
                                <span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-xs font-bold mr-2">DAY ${day.day}</span>
                                <h2 class="inline-block font-bold text-gray-700">${day.date} | ${day.city} Â· ${day.title}</h2>
                            </div>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="day-content">
                            <div class="p-5">
                                ${day.image ? `<div class="image-placeholder" style="background-image:url('${day.image}')"></div>` : ''}
                                <div class="space-y-4">
                                    ${day.events.map(e => {
                                        // åˆ¤æ–·æ˜¯å¦ã€Œæ²’æœ‰ç‰¹åˆ¥æç¤ºã€ï¼ˆç„¡äº¤é€šè³‡è¨Šä¸”ç„¡åœ°åœ–ä½ç½®ï¼‰
                                        const noSpecialInfo = !e.transport && !e.mapLocation;
                                        return `
                                        <div class="timeline-event">
                                            <div class="event-time">${e.time}</div>
                                            <div class="flex justify-between items-start">
                                                <div class="text-gray-700">
                                                    <p class="font-medium ${noSpecialInfo ? 'event-highlight' : ''}">${e.detail}</p>
                                                    ${e.transport ? `<p class="text-xs text-gray-400 mt-1">ğŸš— ${e.transport}</p>` : ''}
                                                </div>
                                                ${e.mapLocation ? `
                                                    <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.mapLocation)}" 
                                                       target="_blank" class="p-2 bg-gray-50 rounded-full hover:bg-indigo-50 text-indigo-500 transition-colors">
                                                       ğŸ“
                                                    </a>` : ''}
                                            </div>
                                        </div>
                                    `;}).join('')}
                                </div>
                                ${day.notes ? `<div class="mt-4 p-3 bg-amber-50 border-l-4 border-amber-400 text-amber-800 text-sm"><strong>ğŸ’¡ å‚™è¨»:</strong> ${day.notes}</div>` : ''}
                            </div>
                        </div>
                    `;
                    timeline.appendChild(card);
                }
            });
        }

        // --- æº–å‚™æ¸…å–®è®€å– ---
        async function loadChecklist() {
            const container = document.getElementById('checklist-content');
            const status = document.getElementById('sync-status');
            container.innerHTML = '<div class="text-center py-10 text-gray-400">æ­£åœ¨è®€å– GitHub æ¸…å–®...</div>';
            
            try {
                const res = await fetch(GIST_URL + '?t=' + new Date().getTime());
                if (!res.ok) throw new Error();
                const text = await res.text();
                status.textContent = 'âœ… å·²èˆ‡ GitHub åŒæ­¥';
                renderChecklist(text);
            } catch (e) {
                status.textContent = 'âš ï¸ è¼‰å…¥å¤±æ•—ï¼Œé¡¯ç¤ºé›¢ç·šç‰ˆæœ¬';
                renderChecklist("## ğŸš— è‡ªé§•å¿…å‚™\n- [ ] å°ç£é§•ç…§æ­£æœ¬\n- [ ] æ—¥æ–‡è­¯æœ¬\n- [ ] ä¿¡ç”¨å¡\n## ğŸ›‚ é‡è¦è­‰ä»¶\n- [ ] è­·ç…§\n- [ ] Visit Japan Web");
            }
        }

        function renderChecklist(md) {
            const container = document.getElementById('checklist-content');
            const saved = JSON.parse(localStorage.getItem('jp_checklist_v1')) || {};
            container.innerHTML = '';
            
            md.split('\n').forEach(line => {
                const text = line.trim();
                if (text.startsWith('##')) {
                    const h = document.createElement('div');
                    h.className = 'font-bold text-gray-800 border-b pb-2 mb-2 mt-6';
                    h.textContent = text.replace('##', '').trim();
                    container.appendChild(h);
                } else if (text.includes('- [ ]') || text.startsWith('-')) {
                    const label = text.replace(/- \[[x ]\] /g, '').replace(/- /g, '').trim();
                    if(!label) return;
                    
                    const item = document.createElement('div');
                    item.className = 'todo-item hover:bg-gray-50 rounded-lg';
                    const isChecked = saved[label] || false;
                    
                    item.innerHTML = `
                        <input type="checkbox" class="w-5 h-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-3" ${isChecked ? 'checked' : ''}>
                        <span class="todo-text ${isChecked ? 'done' : ''}">${label}</span>
                    `;
                    
                    item.onclick = (e) => {
                        const cb = item.querySelector('input');
                        if (e.target !== cb) cb.checked = !cb.checked;
                        item.querySelector('span').classList.toggle('done', cb.checked);
                        saved[label] = cb.checked;
                        localStorage.setItem('jp_checklist_v1', JSON.stringify(saved));
                    };
                    container.appendChild(item);
                }
            });
        }

        window.onload = initApp;
    </script>
</body>
</html>
